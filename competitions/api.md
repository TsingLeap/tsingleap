# 可用 API：比赛管理

所有接口均以 `/competitions/` 为前缀

---

### `create_competition/`

`POST` 请求，创建新比赛。传入格式：

```json
{
  "name": "比赛名称",
  "sport": "赛事类型",
  "is_finished": false,
  "time_begin": "2025-04-19T14:30:00Z",
  "tag_ids": [1, 2]
}
```

请求参数：

| 参数         | 类型   | 说明        |
| ------------ | ------ | ----------- |
| name         | string | 比赛名称    |
| sport        | string | 比赛类型    |
| is\_finished | bool   | 是否已结束  |
| time\_begin  | string | 开始时间    |
| tag_ids      | list   | tag的id列表 |

响应状态：

| 状态码 | 说明                           |
| ------ | ------------------------------ |
| 0      | 创建成功                       |
| 1111   | 存在某个tag不是competition tag |
| 1112   | tag的个数过多                  |

返回字段（data）：

| **字段名**   | **类型** | **说明**                                            |
| ------------ | -------- | --------------------------------------------------- |
| id           | int      | 比赛 ID                                             |
| name         | string   | 比赛名称                                            |
| sport        | string   | 比赛项目类型                                        |
| is_finished  | bool     | 是否已结束                                          |
| time_begin   | string   | 开始时间                                            |
| created_at   | string   | 创建时间                                            |
| updated_at   | string   | 最后更新时间                                        |

---

### `get_competition_list/`

`POST` 请求，分页获取比赛列表（进行中或已结束）

请求参数：

| 参数         | 类型   | 说明                                  |
| ------------ | ------ | ------------------------------------- |
| user_id      | int    | 用户id                                |
| tag_list     | list   | tag的list                             |
| search_text  | str    | 搜索的内容                            |
| before\_time | string | 上一页最后一场比赛开始时间，首页传 "" |
| before\_id   | int    | 上一页最后一场比赛 ID，首页传 -1      |
| is\_finished | bool   | 是否获取已结束比赛                    |
| filter_focus | bool   | 是否筛选关注比赛                      |

响应状态：

| 状态码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| 1100   | 没有更多比赛 |

返回字段（data）：

| 字段                | 类型     | 说明              |
| ----------------- | ------ | --------------- |
| competition\_list | list   | 比赛信息列表（结构同比赛详情） |
| before\_time      | string | 最后一场比赛的开始时间     |
| before\_id        | int    | 最后一场比赛的 ID      |

注意competition_list里会多出"is_focus"项，表示该赛事是否被该用户关注。

---

### `get_competition_info/`

`GET` 请求，获取比赛详情

请求参数：

| 参数 | 类型  | 说明    |
| -- | --- | ----- |
| id | int | 比赛 ID |

响应状态：

| 状态码 | 说明       |
| ------ | ---------- |
| 0      | 成功       |
| 1101   | 比赛不存在 |

返回字段（data.competition）：

| 字段         | 类型   | 说明         |
| ------------ | ------ | ------------ |
| id           | int    | 比赛 ID      |
| name         | string | 比赛名称     |
| sport        | string | 项目类型     |
| is\_finished | bool   | 是否结束     |
| time\_begin  | string | 比赛开始时间 |
| created\_at  | string | 创建时间     |
| updated\_at  | string | 更新时间     |

---

### `update_competition/`

`POST` 请求，更新比赛信息

请求格式：

```json
{
  "id": 1,
  "name": "更新后的名称",
  "sport": "项目",
  "is_finished": true,
  "time_begin": "2025-04-20T10:00:00Z",
  "tag_ids": [1, 2]
}
```

响应状态：

| 状态码 | 说明                           |
| ------ | ------------------------------ |
| 0      | 成功                           |
| 1102   | 比赛不存在                     |
| 1113   | 存在某个tag不是competition tag |
| 1114   | tag的个数过多                  |

---

### `delete_competition/`

`POST` 请求，删除指定比赛

请求格式：

```json
{
  "id": 1
}
```

请求参数：

| 参数 | 类型  | 说明    |
| -- | --- | ----- |
| id | int | 比赛 ID |

响应状态：

| 状态码 | 说明       |
| ------ | ---------- |
| 0      | 删除成功   |
| 1103   | 比赛不存在 |

---

### `add_participant/`

`POST` 请求，增加参赛者

请求参数：

| 参数           | 类型 | 说明                                          |
| -------------- | ---- | --------------------------------------------- |
| competition_id | int  | 比赛 ID                                       |
| participants   | list | 参赛者列表，每一项包含name和score这两个键值对 |

响应状态：

| 状态码 | 说明       |
| ------ | ---------- |
| 0      | 成功       |
| 1118   | 比赛不存在 |

---

### `delete_participant/`

`POST` 请求，删除参赛者

请求参数：

| 参数            | 类型 | 说明           |
| --------------- | ---- | -------------- |
| participant_ids | list | 参赛者id的列表 |

响应状态：

| 状态码 | 说明 |
| ------ | ---- |
| 0      | 成功 |

---

### `update_participant/`

`POST` 请求，修改参赛者信息

请求参数：

| 参数         | 类型 | 说明                                              |
| ------------ | ---- | ------------------------------------------------- |
| participants | list | 参赛者列表，每一项包含id, name, score这三个键值对 |

响应状态：

| 状态码 | 说明 |
| ------ | ---- |
| 0      | 成功 |

---

### `get_participant_list/`

`GET` 请求，获得参赛者列表

请求参数：

| 参数           | 类型 | 说明   |
| -------------- | ---- | ------ |
| competition_id | int  | 比赛id |
| user_id        | int  | 用户id |

响应状态：

| 状态码 | 说明       |
| ------ | ---------- |
| 0      | 成功       |
| 1120   | 比赛不存在 |

返回字段：

| 字段              | 类型 | 说明                                                         |
| ----------------- | ---- | ------------------------------------------------------------ |
| participant\_list | list | 参赛者数组，每项包含 id, name, score, like（是否点赞）, like_count（点赞数） |

---

### `get_competition_admin_list/`

`GET` 请求，获取比赛管理员信息

请求参数：

| 参数 | 类型  | 说明    |
| -- | --- | ----- |
| id | int | 比赛 ID |

响应状态：

| 状态码 | 说明       |
| ------ | ---------- |
| 0      | 成功       |
| 1104   | 比赛不存在 |

返回字段：

| 字段          | 类型   | 说明                             |
| ----------- | ---- | ------------------------------ |
| admin\_list | list | 管理员数组，每项包含 username 与 nickname |

---

### `add_competition_focus/`

`POST` 请求，关注比赛

请求格式：

```json
{
  "competition_id": 1,
  "user_id": 42
}
```

响应状态：

| 状态码 | 说明       |
| ------ | ---------- |
| 0      | 成功       |
| 1105   | 比赛不存在 |
| 1106   | 已经关注   |

---

### `del_competition_focus/`

`POST` 请求，取消关注比赛

请求格式：

```json
{
  "competition_id": 1,
  "user_id": 42
}
```

响应状态：

| 状态码 | 说明       |
| ------ | ---------- |
| 0      | 成功       |
| 1107   | 比赛不存在 |
| 1108   | 未关注     |

---

### `get_tag_list_by_competition/`

`GET` 请求，通过赛事 ID 获取标签列表

请求格式：

```json
{
  "competition_id": 43
}
```

响应状态：

| 状态码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| 1109   | 未找到该比赛 |

返回字段（data）：

| 字段     | 类型 | 说明     |
| -------- | ---- | -------- |
| tag_list | list | 标签列表 |

tag_list中每个标签的格式如下

```json
{
    "id": tag.id,
    "name": tag.name,
    "tag_type": tag.tag_type,
    "is_post_tag": tag.is_post_tag,
    "is_competition_tag": tag.is_competition_tag
}
```

------

### `like_participant/`

`POST` 请求，为某位参赛选手点赞。

请求参数：

| **参数**       | **类型** | **说明**        |
| -------------- | -------- | --------------- |
| user_id        | int      | 点赞用户的 ID   |
| participant_id | int      | 被点赞的选手 ID |

响应状态：

| **状态码** | **说明**                         |
| ---------- | -------------------------------- |
| 0          | 点赞成功                         |
| 1115       | 选手不存在                       |
| 1116       | 用户不存在                       |
| 1117       | 用户已对该选手点赞，无法重复点赞 |

------

### `unlike_participant/`

`POST` 请求，取消对某位参赛选手的点赞。

请求参数：

| **参数**       | **类型** | **说明**            |
| -------------- | -------- | ------------------- |
| user_id        | int      | 点赞用户的 ID       |
| participant_id | int      | 被取消点赞的选手 ID |

响应状态：

| **状态码** | **说明**                       |
| ---------- | ------------------------------ |
| 0          | 取消点赞成功                   |
| 1121       | 选手不存在                     |
| 1122       | 用户不存在                     |
| 1123       | 用户尚未对该选手点赞，无法取消 |

------

### `get_like_count/`

`GET` 请求，获得点赞个数。

请求参数：

| **参数**       | **类型** | **说明**            |
| -------------- | -------- | ------------------- |
| participant_id | int      | 选手 ID |
| user_id | int | 用户id |

响应状态：

| **状态码** | **说明**                       |
| ---------- | ------------------------------ |
| 0          | 取消点赞成功                   |
| 1125       | 选手不存在                     |

返回字段（data）

| 字段     | 类型 | 说明     |
| -------- | ---- | -------- |
| like_count | int | 点赞个数 |
| is_like | bool | 该用户是否点赞 |